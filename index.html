<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>FridgeMind ‚Äî Dashboard</title>
<style>
:root{
  --bg-main:#E6E6FA; /* lavender */
  --card:#F7F4FA;
  --pink:#FFB6C1; 
  --pink-gradient: linear-gradient(135deg, #FFB6C1, #FFC0CB);
  --mint:#A8E6CF;
  --red:#FF6B6B;
  --shadow:0 4px 14px rgba(0,0,0,0.08);
  --warn-bg:#FF6B6B;
}
body{
  margin:0; font-family:Poppins,system-ui,-apple-system,Segoe UI,Roboto,Arial;
  background: var(--bg-main);
  color:#333; padding:0;
}
h1{ text-align:center; margin:6px 0 18px; color:#9B59B6; }
.wrap{ max-width:960px; margin:0 auto; padding:20px; display:flex; gap:20px; }
.sidebar{
  width:220px; background:#D8BFD8; border-radius:16px; padding:16px; display:flex; flex-direction:column; gap:12px; height:90vh;
  position:fixed; top:20px; left:-240px; transition:0.3s; z-index:10;
}
.sidebar.show{ left:20px; }
.sidebar button{ padding:10px; border:none; border-radius:12px; cursor:pointer; font-weight:600; background:var(--pink); color:#fff; text-align:left; }
.sidebar button.delete{ background:var(--red); }
.main{ flex:1; margin-left:240px; transition:0.3s; display:flex; flex-direction:column; align-items:center; }
.card{ background:var(--card); border-radius:16px; padding:18px; box-shadow:var(--shadow); margin-bottom:20px; width:100%; max-width:500px; }
.row{ display:flex; gap:10px; flex-wrap:wrap; align-items:center; margin-bottom:8px; }
input[type="text"], input[type="date"]{
  padding:10px 12px; border-radius:12px; border:1px solid #f3dbe2; font-size:14px; flex:1;
}
button.add-btn{ background:var(--pink); background-image: var(--pink-gradient); color:white; border:none; padding:10px 14px; border-radius:12px; cursor:pointer; font-weight:600; }
button.secondary{ background:var(--mint); color:#333; border:1px solid #f3dbe2; }
button.delete-btn{ background:var(--red); color:#fff; border:none; padding:8px 14px; border-radius:12px; cursor:pointer; font-weight:600; }
button.restore-btn{ background:var(--mint); color:#333; border:none; padding:8px 14px; border-radius:12px; cursor:pointer; font-weight:600; }
button:disabled{ opacity:.6; transform:none; cursor:default; }
.items{ display:flex; flex-direction:column; gap:10px; width:100%; max-width:500px; }
.item-card{ background:#fff; border-radius:12px; padding:12px; box-shadow:0 2px 8px rgba(0,0,0,.05); display:flex; justify-content:space-between; align-items:flex-start; gap:12px; flex-wrap:wrap; }
.info{ display:flex; flex-direction:column; gap:6px; min-width:220px; }
.name{ font-weight:700; font-size:15px; }
.expiry{ color:#666; font-size:14px; }
.badge{ background:var(--warn-bg); color:#fff; padding:4px 10px; border-radius:999px; font-weight:700; font-size:12px; }
.suggest{ font-size:13px; color:#666; font-style:italic; }
.small{ font-size:12px; color:#777; }
.toast{ position:fixed; left:50%; transform:translateX(-50%); bottom:20px; background:#222; color:#fff; padding:8px 14px; border-radius:999px; font-size:13px; z-index:999; }
.toggle-menu{ position:fixed; top:20px; left:20px; background:var(--pink); color:#fff; border:none; border-radius:12px; padding:10px 14px; cursor:pointer; font-weight:600; z-index:11; }
.test-notif{ position:fixed; top:20px; right:20px; background:var(--mint); color:#333; border:none; border-radius:12px; padding:10px 14px; cursor:pointer; font-weight:600; z-index:12; }
.analytics-panel{ background:#F0E6FA; border-radius:16px; padding:16px; margin-bottom:20px; box-shadow:var(--shadow); transition:0.3s; width:100%; max-width:500px; display:none; flex-direction:column; }
.analytics-header{ display:flex; justify-content:space-between; cursor:pointer; align-items:center; }
.analytics-content{ display:flex; gap:20px; flex-wrap:wrap; margin-top:10px; }
  <!-- Add this inside your analytics-panel, below analyticsContent -->
<canvas id="analyticsChart" style="max-width:500px; margin-top:16px;"></canvas>

<!-- Add Chart.js before closing body -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
function renderAnalyticsChart(){
  const ctx = document.getElementById('analyticsChart').getContext('2d');
  const todayCount = allItems.filter(i=>daysUntil(i.expiry)===0 && !trash.includes(i)).length;
  const weekCount = allItems.filter(i=>daysUntil(i.expiry)>0 && daysUntil(i.expiry)<=7 && !trash.includes(i)).length;

  const categories = { "Vegetables":0, "Fruits":0, "Dairy":0, "Grains":0, "Other":0 };
  allItems.forEach(i=>{
    if(!trash.includes(i)){
      const key = i.key;
      const cat = key && pantry[key]? pantry[key].category : "Other";
      categories[cat]++; 
    }
  });

  if(window.fridgeChart) fridgeChart.destroy(); // remove old chart
  window.fridgeChart = new Chart(ctx, {
    type:'bar',
    data:{
      labels:['Today Expiring','This Week','Vegetables','Fruits','Dairy','Grains','Other'],
      datasets:[{
        label:'Items Count',
        data:[todayCount, weekCount, categories.Vegetables, categories.Fruits, categories.Dairy, categories.Grains, categories.Other],
        backgroundColor:[
          '#FFB6C1','#FFD1DC','#A8E6CF','#FFECB3','#D8BFD8','#B0E0E6','#FFC0CB'
        ],
        borderRadius:8
      }]
    },
    options:{
      plugins:{ legend:{ display:false } },
      scales:{
        y:{ beginAtZero:true, ticks:{stepSize:1} }
      }
    }
  });
}

// Update chart whenever analytics updates
function updateAnalytics(){
  // existing analytics code...
  const todayCount = allItems.filter(i=>daysUntil(i.expiry)===0 && !trash.includes(i)).length;
  const weekCount = allItems.filter(i=>daysUntil(i.expiry)>0 && daysUntil(i.expiry)<=7 && !trash.includes(i)).length;
  // ...rest of existing code
  renderAnalyticsChart(); // <-- call chart rendering
}
</script>

.analytics-card{ background:#fff; border-radius:12px; padding:12px 14px; box-shadow:0 2px 6px rgba(0,0,0,.08); flex:1 1 120px; text-align:center; }
.analytics-card h4{ margin:0 0 6px; font-size:14px; color:#666; }
.analytics-card p{ margin:0; font-weight:700; font-size:16px; color:#333; }
/* Reminder card */
.reminder-card{ background:#FFFAF0; border-radius:12px; padding:10px 12px; margin-top:10px; text-align:center; font-weight:600; color:#333; box-shadow:0 2px 6px rgba(0,0,0,.05); font-size:14px; }
</style>
</head>
<body>

<button class="toggle-menu">‚ò∞ Menu</button>
<button class="test-notif" id="testNotifBtn">üîî Test Notification</button>

<div class="sidebar" id="sidebar">
  <button id="homeBtn">üè† Home / Dashboard</button>
  <button id="categoriesBtn">ü•õ Categories</button>
  <div id="categorySubmenu" style="display:none; flex-direction:column; gap:6px; margin-left:12px;">
    <button data-cat="Vegetables">ü•ï Vegetables</button>
    <button data-cat="Fruits">üçé Fruits</button>
    <button data-cat="Dairy">ü•õ Dairy</button>
    <button data-cat="Grains">üçö Grains</button>
    <button data-cat="Other">üç≤ Other</button>
  </div>
  <button id="expiryBtn">‚ö†Ô∏è Near Expiry</button>
  <button id="recipesBtn">üç≥ Recipe Suggestions</button>
  <button id="analyticsBtn">üìä Analytics & Stats</button>
  <button id="trashBtn" class="delete">üóëÔ∏è Trash / Deleted Items</button>
</div>

<div class="main">
  <h1>ü•ï FridgeMind ‚Äî Track Items</h1>

  <div class="card">
    <div class="row">
      <input id="itemName" type="text" placeholder="Enter item name üçÖ" />
      <input id="expiryDate" type="date" />
      <button id="addBtn" class="add-btn">‚ûï Add</button>
    </div>
  </div>

  <!-- Analytics Panel -->
  <div class="analytics-panel" id="analyticsPanel">
    <div class="analytics-header">
      <h3>üìä Fridge Analytics</h3>
      <span id="toggleAnalytics" style="font-size:18px; cursor:pointer;">‚ñº</span>
    </div>
    <div class="analytics-content" id="analyticsContent">
      <!-- Cards populated dynamically -->
    </div>
    <div id="dailyReminders"></div>
  </div>

  <div class="items" id="itemList"></div>
</div>

<script>
// Pantry data
const pantry = {
  "tomato": { emoji:"üçÖ", recipes:["Tomato Chutney","Tomato Rasam","Tomato Rice"], expiry:7, category:"Vegetables" },
  "onion": { emoji:"üßÖ", recipes:["Onion Chutney","Onion Pakora","Onion Sambar"], expiry:10, category:"Vegetables" },
  "potato": { emoji:"ü•î", recipes:["Aloo Curry","Aloo Paratha","Jeera Aloo"], expiry:14, category:"Vegetables" },
  "carrot": { emoji:"ü•ï", recipes:["Carrot Halwa","Carrot Poriyal"], expiry:7, category:"Vegetables" },
  "bread": { emoji:"üçû", recipes:["Bread Upma","Bread Pakora"], expiry:3, category:"Grains" },
  "milk": { emoji:"ü•õ", recipes:["Make Paneer","Kheer"], expiry:3, category:"Dairy" },
  "curd": { emoji:"ü•õ", recipes:["Curd Rice","Raita"], expiry:5, category:"Dairy" },
  "rice": { emoji:"üçö", recipes:["Lemon Rice","Curd Rice"], expiry:180, category:"Grains" },
  "egg": { emoji:"ü•ö", recipes:["Egg Curry","Egg Bhurji"], expiry:10, category:"Other" },
  "paneer": { emoji:"üßÄ", recipes:["Paneer Butter Masala","Paneer Bhurji"], expiry:7, category:"Dairy" },
  "mango": { emoji:"ü•≠", recipes:["Mango Lassi","Mango Pickle"], expiry:5, category:"Fruits" },
  "apple": { emoji:"üçé", recipes:["Apple Halwa","Apple Juice"], expiry:10, category:"Fruits" }
};
const aliases = { "tomatoes":"tomato","potatoes":"potato" };

// UI refs
const sidebar = document.getElementById('sidebar');
const toggleMenu = document.querySelector('.toggle-menu');
const itemNameInput = document.getElementById('itemName');
const expiryInput = document.getElementById('expiryDate');
const addBtn = document.getElementById('addBtn');
const itemList = document.getElementById('itemList');
const testNotifBtn = document.getElementById('testNotifBtn');
const analyticsPanel = document.getElementById('analyticsPanel');
const analyticsContent = document.getElementById('analyticsContent');
const dailyRemindersDiv = document.getElementById('dailyReminders');
const toggleAnalytics = document.getElementById('toggleAnalytics');
const homeBtn = document.getElementById('homeBtn');
const trashBtn = document.getElementById('trashBtn');
const expiryBtn = document.getElementById('expiryBtn');
const recipesBtn = document.getElementById('recipesBtn');
const categoriesBtn = document.getElementById('categoriesBtn');
const categorySubmenu = document.getElementById('categorySubmenu');
const analyticsBtn = document.getElementById('analyticsBtn');

let allItems = [];
let trash = [];

// Toggle sidebar
toggleMenu.addEventListener('click', ()=> sidebar.classList.toggle('show'));

// Toggle analytics panel
analyticsBtn.addEventListener('click', ()=>{
  analyticsPanel.style.display = analyticsPanel.style.display==='flex'?'none':'flex';
  updateAnalytics();
});

// Notification
testNotifBtn.addEventListener('click', ()=>{
  if(Notification.permission!=='granted') Notification.requestPermission();
  else{
    const notif = new Notification("FridgeMind Test", { body:"This is a test notification!", icon:"https://i.imgur.com/8QfU5Yq.png" });
    const audio = new Audio('https://www.soundjay.com/button/beep-07.wav');
    audio.play();
  }
});

// Helpers
function normalize(s){ return (s||"").toString().trim().toLowerCase(); }
function findPantryKeyFromLabel(label){
  if(!label) return null;
  const L = normalize(label);
  if(aliases[L]) return aliases[L];
  if(pantry[L]) return L;
  for(const key of Object.keys(pantry)){
    if(L.includes(key)) return key;
  }
  return null;
}
function daysUntil(dateStr){
  const t = new Date();
  const e = new Date(dateStr);
  return Math.ceil((e - t) / (1000*60*60*24));
}
function showToast(msg){
  const t = document.createElement('div');
  t.className='toast'; t.textContent=msg;
  document.body.appendChild(t);
  setTimeout(()=> t.remove(),2500);
}

// Add item
addBtn.addEventListener('click', ()=>addItem());
function addItem(itemData){
  let raw = itemData?.name || itemNameInput.value.trim();
  if(!raw) { showToast("Enter item name"); return; }
  let keyTry = findPantryKeyFromLabel(raw.toLowerCase()) || null;
  let expiryDays = keyTry ? pantry[keyTry].expiry : 3;
  let expiry = itemData?.expiry || expiryInput.value || (()=>{ const d=new Date(); d.setDate(d.getDate()+expiryDays); return d.toISOString().split('T')[0]; })();
  const itemObj = { name: raw, expiry: expiry, key: keyTry };
  allItems.push(itemObj);
  renderItem(itemObj);
  updateAnalytics();
  if(!itemData){ itemNameInput.value=''; expiryInput.value=''; }
}

// Render individual card
function renderItem(obj){
  const dleft = daysUntil(obj.expiry);
  const card = document.createElement('div'); card.className='item-card';
  const info = document.createElement('div'); info.className='info';
  if(dleft<=3){ 
    const b=document.createElement('div'); b.className='badge'; b.textContent=`‚ö†Ô∏è Near Expiry (${dleft}d)`; info.appendChild(b);
    const notifKey=obj.key||obj.name.toLowerCase();
    const lastNotif=localStorage.getItem('notif_'+notifKey);
    const today=new Date().toISOString().split('T')[0];
    if(Notification.permission==='granted' && lastNotif!==today){
      new Notification("FridgeMind Alert",{body:`${obj.name} is near expiry!`,icon:"https://i.imgur.com/8QfU5Yq.png"});
      localStorage.setItem('notif_'+notifKey,today);
    }
  }
  const nameLine = document.createElement('div'); nameLine.className='name'; nameLine.textContent=obj.name; info.appendChild(nameLine);
  const expiryLine = document.createElement('div'); expiryLine.className='expiry'; expiryLine.textContent=`Expiry: ${obj.expiry}`; info.appendChild(expiryLine);
  card.appendChild(info);

  // Delete button
  const delBtn=document.createElement('button'); delBtn.className='delete-btn'; delBtn.textContent='üóëÔ∏è Delete';
  delBtn.addEventListener('click', ()=>{ card.remove(); trash.push(obj); showToast(`${obj.name} moved to Trash`); updateAnalytics(); });
  card.appendChild(delBtn);

  itemList.prepend(card);
}

// Update Analytics
function updateAnalytics(){
  const todayCount = allItems.filter(i=>daysUntil(i.expiry)===0 && !trash.includes(i)).length;
  const weekCount = allItems.filter(i=>daysUntil(i.expiry)>0 && daysUntil(i.expiry)<=7 && !trash.includes(i)).length;
  const expiredCount = allItems.filter(i=>daysUntil(i.expiry)<0 && !trash.includes(i)).length;

  const categories = { "Vegetables":0, "Fruits":0, "Dairy":0, "Grains":0, "Other":0 };
  allItems.forEach(i=>{
    if(!trash.includes(i)){
      const key = i.key;
      const cat = key && pantry[key]? pantry[key].category : "Other";
      categories[cat]++; 
    }
  });

  analyticsContent.innerHTML='';
  dailyRemindersDiv.innerHTML='';

  const cards = [
    {title:"Expiring Today", val:todayCount},
    {title:"Expiring This Week", val:weekCount},
    {title:"Expired", val:expiredCount},
    ...Object.keys(categories).map(c=>({title:c, val:categories[c]}))
  ];
  cards.forEach(c=>{
    const div = document.createElement('div'); div.className='analytics-card';
    div.innerHTML=`<h4>${c.title}</h4><p>${c.val}</p>`;
    analyticsContent.appendChild(div);
  });

  // Daily cute reminders
  allItems.filter(i=>!trash.includes(i) && daysUntil(i.expiry)<=3).forEach(i=>{
    const rem = document.createElement('div'); rem.className='reminder-card';
    rem.textContent=`ü•ï ${i.name} is lonely! Use it today üò∏`;
    dailyRemindersDiv.appendChild(rem);
  });
}

// Toggle categories submenu
categoriesBtn.addEventListener('click', ()=>{ categorySubmenu.style.display = categorySubmenu.style.display==='flex'?'none':'flex'; });

// Menu buttons
homeBtn.addEventListener('click', ()=>{ itemList.innerHTML=''; allItems.filter(i=>!trash.includes(i)).forEach(renderItem); showToast("üè† Dashboard"); updateAnalytics(); });
trashBtn.addEventListener('click', ()=>{
  itemList.innerHTML=''; if(trash.length===0){ showToast("Trash is empty"); return; }
  trash.forEach(t=>{
    const card=document.createElement('div'); card.className='item-card';
    const info=document.createElement('div'); info.className='info';
    const nameLine=document.createElement('div'); nameLine.className='name'; nameLine.textContent=t.name; info.appendChild(nameLine);
    const expiryLine=document.createElement('div'); expiryLine.className='expiry'; expiryLine.textContent=`Expiry: ${t.expiry}`; info.appendChild(expiryLine);
    const restoreBtn=document.createElement('button'); restoreBtn.className='restore-btn'; restoreBtn.textContent='‚ôªÔ∏è Restore';
    restoreBtn.addEventListener('click', ()=>{ allItems.push(t); renderItem(t); trash=trash.filter(x=>x!==t); card.remove(); updateAnalytics(); showToast(`${t.name} restored`); });
    card.appendChild(info); card.appendChild(restoreBtn); itemList.appendChild(card);
  });
  showToast("üóëÔ∏è Trash Items");
});
expiryBtn.addEventListener('click', ()=>{ itemList.innerHTML=''; allItems.filter(i=>daysUntil(i.expiry)<=3 && !trash.includes(i)).forEach(renderItem); showToast("‚ö†Ô∏è Near Expiry Items"); });
recipesBtn.addEventListener('click', ()=>{ itemList.innerHTML=''; const nearExpiring = allItems.filter(i=>daysUntil(i.expiry)<=3 && !trash.includes(i)); if(nearExpiring.length===0){ showToast("No near-expiry items"); return; } nearExpiring.forEach(renderItem); showToast("üç≥ Recipe Magic"); });
categorySubmenu.querySelectorAll('button').forEach(b=>{ b.addEventListener('click', ()=>{ const cat = b.dataset.cat; itemList.innerHTML=''; allItems.filter(i=>{ if(trash.includes(i)) return false; const key=i.key; const c = key && pantry[key]? pantry[key].category : "Other"; return c===cat; }).forEach(renderItem); showToast(`üìÇ ${cat}`); }); });
</script>
</body>
</html>


