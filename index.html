<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>FridgeMind — Dashboard</title>
<style>
:root{
  --bg-main:#E6E6FA; /* lavender */
  --card:#F7F4FA;
  --pink:#FFB6C1; 
  --pink-gradient: linear-gradient(135deg, #FFB6C1, #FFC0CB);
  --mint:#A8E6CF;
  --red:#FF6B6B;
  --shadow:0 4px 14px rgba(0,0,0,0.08);
  --warn-bg:#FF6B6B;
}
body{
  margin:0; font-family:Poppins,system-ui,-apple-system,Segoe UI,Roboto,Arial;
  background: var(--bg-main);
  color:#333; padding:0;
}
h1{ text-align:center; margin:6px 0 18px; color:#9B59B6; }
.wrap{ max-width:960px; margin:0 auto; padding:20px; display:flex; gap:20px; }
.sidebar{
  width:220px; background:#D8BFD8; border-radius:16px; padding:16px; display:flex; flex-direction:column; gap:12px; height:90vh;
  position:fixed; top:20px; left:-240px; transition:0.3s; z-index:10;
}
.sidebar.show{ left:20px; }
.sidebar button{ padding:10px; border:none; border-radius:12px; cursor:pointer; font-weight:600; background:var(--pink); color:#fff; text-align:left; }
.sidebar button.delete{ background:var(--red); }
.main{ flex:1; margin-left:240px; transition:0.3s; display:flex; flex-direction:column; align-items:center; }
.card{ background:var(--card); border-radius:16px; padding:18px; box-shadow:var(--shadow); margin-bottom:20px; width:100%; max-width:500px; }
.row{ display:flex; gap:10px; flex-wrap:wrap; align-items:center; margin-bottom:8px; }
input[type="text"], input[type="date"]{
  padding:10px 12px; border-radius:12px; border:1px solid #f3dbe2; font-size:14px; flex:1;
}
button.add-btn{ background:var(--pink); background-image: var(--pink-gradient); color:white; border:none; padding:10px 14px; border-radius:12px; cursor:pointer; font-weight:600; }
button.secondary{ background:var(--mint); color:#333; border:1px solid #f3dbe2; }
button.delete-btn{ background:var(--red); color:#fff; border:none; padding:8px 14px; border-radius:12px; cursor:pointer; font-weight:600; }
button.restore-btn{ background:var(--mint); color:#333; border:none; padding:8px 14px; border-radius:12px; cursor:pointer; font-weight:600; }
button:disabled{ opacity:.6; transform:none; cursor:default; }
.items{ display:flex; flex-direction:column; gap:10px; width:100%; max-width:500px; }
.item-card{ background:#fff; border-radius:12px; padding:12px; box-shadow:0 2px 8px rgba(0,0,0,.05); display:flex; justify-content:space-between; align-items:flex-start; gap:12px; flex-wrap:wrap; }
.info{ display:flex; flex-direction:column; gap:6px; min-width:220px; }
.name{ font-weight:700; font-size:15px; }
.expiry{ color:#666; font-size:14px; }
.badge{ background:var(--warn-bg); color:#fff; padding:4px 10px; border-radius:999px; font-weight:700; font-size:12px; }
.suggest{ font-size:13px; color:#666; font-style:italic; }
.small{ font-size:12px; color:#777; }
.toast{ position:fixed; left:50%; transform:translateX(-50%); bottom:20px; background:#222; color:#fff; padding:8px 14px; border-radius:999px; font-size:13px; z-index:999; }
.toggle-menu{ position:fixed; top:20px; left:20px; background:var(--pink); color:#fff; border:none; border-radius:12px; padding:10px 14px; cursor:pointer; font-weight:600; z-index:11; }
.test-notif{ position:fixed; top:20px; right:20px; background:var(--mint); color:#333; border:none; border-radius:12px; padding:10px 14px; cursor:pointer; font-weight:600; z-index:12; }
.analytics-panel{ background:#F0E6FA; border-radius:16px; padding:16px; margin-bottom:20px; box-shadow:var(--shadow); transition:0.3s; width:100%; max-width:500px; display:none; flex-direction:column; }
.analytics-header{ display:flex; justify-content:space-between; cursor:pointer; align-items:center; }
.analytics-content{ display:flex; gap:20px; flex-wrap:wrap; margin-top:10px; }
.analytics-card{ background:#fff; border-radius:12px; padding:12px 14px; box-shadow:0 2px 6px rgba(0,0,0,.08); flex:1 1 120px; text-align:center; }
.analytics-card h4{ margin:0 0 6px; font-size:14px; color:#666; }
.analytics-card p{ margin:0; font-weight:700; font-size:16px; color:#333; }
/* Reminder card */
.reminder-card{ background:#FFFAF0; border-radius:12px; padding:10px 12px; margin-top:10px; text-align:center; font-weight:600; color:#333; box-shadow:0 2px 6px rgba(0,0,0,.05); font-size:14px; }
</style>
</head>
<body>

<button class="toggle-menu">☰ Menu</button>
<button class="test-notif" id="testNotifBtn">🔔 Test Notification</button>

<div class="sidebar" id="sidebar">
  <button id="homeBtn">🏠 Home / Dashboard</button>
  <button id="categoriesBtn">🥛 Categories</button>
  <div id="categorySubmenu" style="display:none; flex-direction:column; gap:6px; margin-left:12px;">
    <button data-cat="Vegetables">🥕 Vegetables</button>
    <button data-cat="Fruits">🍎 Fruits</button>
    <button data-cat="Dairy">🥛 Dairy</button>
    <button data-cat="Grains">🍚 Grains</button>
    <button data-cat="Other">🍲 Other</button>
  </div>
  <button id="expiryBtn">⚠️ Near Expiry</button>
  <button id="recipesBtn">🍳 Recipe Suggestions</button>
  <button id="analyticsBtn">📊 Analytics & Stats</button>
  <button id="trashBtn" class="delete">🗑️ Trash / Deleted Items</button>
</div>

<div class="main">
  <h1>🥕 FridgeMind — Track Items</h1>

  <div class="card">
    <div class="row">
      <input id="itemName" type="text" placeholder="Enter item name 🍅" />
      <input id="expiryDate" type="date" />
      <button id="addBtn" class="add-btn">➕ Add</button>
    </div>
  </div>

  <div id="itemList" class="items"></div>

  <!-- Analytics Panel -->
  <div class="analytics-panel" id="analyticsPanel">
    <div class="analytics-header">
      <h3>📊 Fridge Analytics</h3>
      <span id="toggleAnalytics" style="font-size:18px; cursor:pointer;">▼</span>
    </div>
    <div class="analytics-content" id="analyticsContent"></div>
    <div id="dailyReminders"></div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
// Pantry data
const pantry = {
  "tomato": { emoji:"🍅", recipes:["Tomato Chutney","Tomato Rasam","Tomato Rice"], expiry:7, category:"Vegetables" },
  "onion": { emoji:"🧅", recipes:["Onion Chutney","Onion Pakora","Onion Sambar"], expiry:10, category:"Vegetables" },
  "potato": { emoji:"🥔", recipes:["Aloo Curry","Aloo Paratha","Jeera Aloo"], expiry:14, category:"Vegetables" },
  "carrot": { emoji:"🥕", recipes:["Carrot Halwa","Carrot Poriyal"], expiry:7, category:"Vegetables" },
  "bread": { emoji:"🍞", recipes:["Bread Upma","Bread Pakora"], expiry:3, category:"Grains" },
  "milk": { emoji:"🥛", recipes:["Make Paneer","Kheer"], expiry:3, category:"Dairy" },
  "curd": { emoji:"🥛", recipes:["Curd Rice","Raita"], expiry:5, category:"Dairy" },
  "rice": { emoji:"🍚", recipes:["Lemon Rice","Curd Rice"], expiry:180, category:"Grains" },
  "egg": { emoji:"🥚", recipes:["Egg Curry","Egg Bhurji"], expiry:10, category:"Other" },
  "paneer": { emoji:"🧀", recipes:["Paneer Butter Masala","Paneer Bhurji"], expiry:7, category:"Dairy" },
  "mango": { emoji:"🥭", recipes:["Mango Lassi","Mango Pickle"], expiry:5, category:"Fruits" },
  "apple": { emoji:"🍎", recipes:["Apple Halwa","Apple Juice"], expiry:10, category:"Fruits" },

  /* --- Added regional staples (South + North) --- */
  "beans": { emoji:"🫘", recipes:["Beans Poriyal","Beans Thoran"], expiry:6, category:"Vegetables" },
  "bhindi": { emoji:"🌿", recipes:["Bhindi Masala","Vendakkai Fry"], expiry:5, category:"Vegetables" },
  "okra":   { emoji:"🌿", recipes:["Bhindi Masala","Vendakkai Fry"], expiry:5, category:"Vegetables" }, /* alias item */
  "cabbage": { emoji:"🥬", recipes:["Cabbage Poriyal","Patta Gobhi Sabzi"], expiry:7, category:"Vegetables" },
  "cauliflower": { emoji:"🥦", recipes:["Gobi 65","Aloo Gobi"], expiry:6, category:"Vegetables" },
  "green peas": { emoji:"🟢", recipes:["Peas Masala","Matar Paneer"], expiry:5, category:"Vegetables" },
  "coriander": { emoji:"🌿", recipes:["Garnish","Chutney"], expiry:4, category:"Vegetables" },

  "wheat flour": { emoji:"🌾", recipes:["Chapati","Paratha"], expiry:90, category:"Grains" },
  "rava": { emoji:"🥣", recipes:["Upma","Rava Dosa"], expiry:120, category:"Grains" },
  "poha": { emoji:"🥣", recipes:["Aval Upma","Poha"], expiry:120, category:"Grains" },
  "idli rice": { emoji:"🍚", recipes:["Idli","Dosa"], expiry:180, category:"Grains" },

  "ghee": { emoji:"🧈", recipes:["Kesari","Dal Tadka"], expiry:30, category:"Dairy" },
  "butter": { emoji:"🧈", recipes:["Butter Naan","Butter Paneer"], expiry:20, category:"Dairy" },
  "yogurt": { emoji:"🥛", recipes:["Raita","Buttermilk"], expiry:5, category:"Dairy" },

  "banana": { emoji:"🍌", recipes:["Banana Fritters","Banana Milkshake"], expiry:5, category:"Fruits" },

  "chicken": { emoji:"🍗", recipes:["Chicken Curry","Butter Chicken"], expiry:3, category:"Other" },
  "fish": { emoji:"🐟", recipes:["Fish Fry","Fish Curry"], expiry:2, category:"Other" },
  "mutton": { emoji:"🍖", recipes:["Mutton Curry","Mutton Biryani"], expiry:3, category:"Other" },

  /* --- Leftovers (always 3 days) --- */
  "sambar": { emoji:"🥣", recipes:["Reheat Sambar","Sambar Idli"], expiry:3, category:"Other" },
  "rasam": { emoji:"🥣", recipes:["Reheat Rasam"], expiry:3, category:"Other" },
  "curd rice": { emoji:"🍚", recipes:["Reheat Curd Rice"], expiry:3, category:"Other" },
  "biryani": { emoji:"🍛", recipes:["Reheat Biryani"], expiry:3, category:"Other" },
  "paneer butter masala": { emoji:"🍲", recipes:["Reheat Paneer Butter Masala"], expiry:3, category:"Other" },
  "dal tadka": { emoji:"🥘", recipes:["Reheat Dal Tadka"], expiry:3, category:"Other" },
  "rajma": { emoji:"🥘", recipes:["Reheat Rajma"], expiry:3, category:"Other" },
  "chole": { emoji:"🥘", recipes:["Reheat Chole"], expiry:3, category:"Other" }
};
const aliases = {
  "tomatoes":"tomato","potatoes":"potato",
  "lady finger":"bhindi","vendakkai":"bhindi","okra":"bhindi",
  "curdrice":"curd rice","idly rice":"idli rice","semolina":"rava","sooji":"rava","suji":"rava",
  "matar":"green peas","gobhi":"cauliflower","patta gobhi":"cabbage"
};

/* NEW: leftover keys list (for quick check) */
const leftovers = ["sambar","rasam","curd rice","biryani","paneer butter masala","dal tadka","rajma","chole"];

let allItems = JSON.parse(localStorage.getItem('allItems')||'[]');
let trash = JSON.parse(localStorage.getItem('trash')||'[]');
let currentPanel = 'home';

// UI refs
const sidebar = document.getElementById('sidebar');
const toggleMenu = document.querySelector('.toggle-menu');
const itemNameInput = document.getElementById('itemName');
const expiryInput = document.getElementById('expiryDate');
const addBtn = document.getElementById('addBtn');
const itemList = document.getElementById('itemList');
const testNotifBtn = document.getElementById('testNotifBtn');
const analyticsPanel = document.getElementById('analyticsPanel');
const analyticsContent = document.getElementById('analyticsContent');
const dailyRemindersDiv = document.getElementById('dailyReminders');
const toggleAnalytics = document.getElementById('toggleAnalytics');
const homeBtn = document.getElementById('homeBtn');
const trashBtn = document.getElementById('trashBtn');
const expiryBtn = document.getElementById('expiryBtn');
const recipesBtn = document.getElementById('recipesBtn');
const categoriesBtn = document.getElementById('categoriesBtn');
const categorySubmenu = document.getElementById('categorySubmenu');
const analyticsBtn = document.getElementById('analyticsBtn');

// --- Helpers ---
function normalize(s){ return (s||"").toString().trim().toLowerCase(); }
function findPantryKeyFromLabel(label){ 
  if(!label) return null;
  const L = normalize(label);
  if(aliases[L]) return aliases[L];
  if(pantry[L]) return L;
  for(const key of Object.keys(pantry)){
    if(L.includes(key)) return key;
  }
  return null;
}
function daysUntil(dateStr){ return Math.ceil((new Date(dateStr)-new Date())/(1000*60*60*24)); }
function showToast(msg){
  const t=document.createElement('div'); t.className='toast'; t.textContent=msg;
  document.body.appendChild(t);
  setTimeout(()=>t.remove(),2500);
}
function saveData(){ localStorage.setItem('allItems',JSON.stringify(allItems)); localStorage.setItem('trash',JSON.stringify(trash)); }
function notifyDevice(title,msg){ if(Notification.permission==='granted') new Notification(title,{body:msg,icon:'https://i.imgur.com/8QfU5Yq.png'}); }
function playReminderSound(){ const audio=new Audio('https://www.soundjay.com/button/beep-07.wav'); audio.play(); }

// --- Render Single Item ---
function renderItem(obj){
  const card=document.createElement('div'); card.className='item-card';
  const info=document.createElement('div'); info.className='info';
  const dleft = daysUntil(obj.expiry);
  if(dleft<=3 && !obj.deleted){ const b=document.createElement('div'); b.className='badge'; b.textContent=`⚠️ Near Expiry (${dleft}d)`; info.appendChild(b); }
  const nameLine=document.createElement('div'); nameLine.className='name'; 
  const emoji = pantry[obj.key]?.emoji || ''; 
  nameLine.textContent = `${emoji} ${obj.name}`; info.appendChild(nameLine);
  const expLine=document.createElement('div'); expLine.className='expiry'; expLine.textContent=`Expires: ${obj.expiry}`; info.appendChild(expLine);
  if(obj.key && pantry[obj.key]?.recipes && dleft<=3 && !obj.deleted){
    const rec = pantry[obj.key].recipes[0]; // first recipe
    const link = document.createElement('a'); link.href=`https://www.youtube.com/results?search_query=${rec.replace(/ /g,'+')}`; link.target="_blank"; link.className='suggest'; link.textContent=`💡 Try: ${rec}`; info.appendChild(link);
  }
  card.appendChild(info);

  const btns=document.createElement('div'); btns.style.display='flex'; btns.style.gap='6px'; btns.style.flexDirection='column';
  if(!obj.deleted){ 
    const del=document.createElement('button'); del.className='delete-btn'; del.textContent='🗑️ Delete'; del.onclick=()=>{ obj.deleted=true; trash.push(obj); allItems=allItems.filter(i=>i!==obj); saveData(); renderCurrentPanel(); showToast('Item moved to trash 🗑️'); };
    btns.appendChild(del);
  } else { 
    const res=document.createElement('button'); res.className='restore-btn'; res.textContent='♻️ Restore'; res.onclick=()=>{ obj.deleted=false; allItems.push(obj); trash=trash.filter(i=>i!==obj); saveData(); renderCurrentPanel(); showToast('Item restored ♻️'); };
    btns.appendChild(res);
  }
  card.appendChild(btns);
  return card;
}

// --- Render Panels ---
function renderCurrentPanel(){
  itemList.innerHTML='';
  analyticsPanel.style.display='none';
  dailyRemindersDiv.innerHTML='';
  if(currentPanel==='home'){ allItems.filter(i=>!i.deleted).forEach(i=>itemList.appendChild(renderItem(i))); }
  else if(currentPanel==='expiry'){ allItems.filter(i=>!i.deleted && daysUntil(i.expiry)<=3).forEach(i=>itemList.appendChild(renderItem(i))); }
  else if(currentPanel==='recipes'){ allItems.filter(i=>!i.deleted && daysUntil(i.expiry)<=3 && pantry[i.key]).forEach(i=>itemList.appendChild(renderItem(i))); }
  else if(currentPanel==='trash'){ trash.forEach(i=>itemList.appendChild(renderItem(i))); }
  else if(currentPanel==='analytics'){ analyticsPanel.style.display='flex'; renderAnalytics(); }
  else if(currentPanel==='categories'){ allItems.filter(i=>!i.deleted).forEach(i=>itemList.appendChild(renderItem(i))); }
}

// --- Analytics ---
function renderAnalytics(){
  const total=allItems.filter(i=>!i.deleted).length;
  const nearExp=allItems.filter(i=>!i.deleted && daysUntil(i.expiry)<=3).length;
  const byCat={}; for(const key in pantry) byCat[pantry[key].category]=0;
  allItems.forEach(i=>{ if(!i.deleted && pantry[i.key]) byCat[pantry[i.key].category]++; });
  analyticsContent.innerHTML='';
  analyticsContent.appendChild(createAnalyticsCard('Total Items',total));
  analyticsContent.appendChild(createAnalyticsCard('Near Expiry',nearExp));
  for(const cat in byCat) analyticsContent.appendChild(createAnalyticsCard(cat,byCat[cat]));

  // Daily Reminders
  dailyRemindersDiv.innerHTML='';
  allItems.filter(i=>!i.deleted).forEach(i=>{
    const card=document.createElement('div'); card.className='reminder-card';
    card.textContent=`${pantry[i.key]?.emoji||''} ${i.name} is lonely! Use it today 😸`;
    dailyRemindersDiv.appendChild(card);
  });
}
function createAnalyticsCard(title,val){ const c=document.createElement('div'); c.className='analytics-card'; c.innerHTML=`<h4>${title}</h4><p>${val}</p>`; return c; }

// --- Add Item ---
addBtn.onclick=()=>{
  const name=itemNameInput.value.trim();
  if(!name) return showToast('Please enter a name! 😿');
  const key = findPantryKeyFromLabel(name);
  const today=new Date();
  let expiry;

  /* NEW: leftover detection has priority and forces 3 days */
  if(key && leftovers.includes(key)){
    expiry = new Date();
    expiry.setDate(today.getDate()+3);
  }
  else if(expiryInput.value) expiry=new Date(expiryInput.value);
  else if(key && pantry[key]){ expiry=new Date(); expiry.setDate(today.getDate()+pantry[key].expiry); }
  else{ expiry=today; expiry.setDate(today.getDate()+7); }

  const obj={ name, key, expiry:expiry.toISOString().split('T')[0], deleted:false };
  allItems.push(obj);
  saveData();
  showToast(`Added ${name} ✅`);
  renderCurrentPanel();
  itemNameInput.value=''; expiryInput.value='';
  notifyDevice('FridgeMind','Added '+name);
  playReminderSound();
};

// --- Panel Switch ---
homeBtn.onclick=()=>{ currentPanel='home'; renderCurrentPanel(); }
expiryBtn.onclick=()=>{ currentPanel='expiry'; renderCurrentPanel(); }
recipesBtn.onclick=()=>{ currentPanel='recipes'; renderCurrentPanel(); }
trashBtn.onclick=()=>{ currentPanel='trash'; renderCurrentPanel(); }
analyticsBtn.onclick=()=>{ currentPanel='analytics'; renderCurrentPanel(); }
categoriesBtn.onclick=()=>{ categorySubmenu.style.display=categorySubmenu.style.display==='flex'?'none':'flex'; }
categorySubmenu.querySelectorAll('button[data-cat]').forEach(btn=>{
  btn.onclick=()=>{ const cat=btn.getAttribute('data-cat'); currentPanel='categories'; renderCurrentPanel(); itemList.innerHTML=''; allItems.filter(i=>!i.deleted && pantry[i.key]?.category===cat).forEach(i=>itemList.appendChild(renderItem(i))); };
});
toggleMenu.onclick=()=>{ sidebar.classList.toggle('show'); }
toggleAnalytics.onclick=()=>{ analyticsContent.style.display=analyticsContent.style.display==='flex'?'none':'flex'; }

// --- Test Notification ---
testNotifBtn.onclick=()=>notifyDevice('FridgeMind','This is a test notification!');

// --- Near Expiry Notifications Twice Daily ---
function scheduleExpiryNotifications(){
  const nearExpItems=allItems.filter(i=>!i.deleted && daysUntil(i.expiry)<=3);
  nearExpItems.forEach(i=>{
    const msg=`${i.name} is near expiry ⚠️`;
    notifyDevice('FridgeMind',msg);
    playReminderSound();
  });
}

// --- Init ---
if(Notification.permission!=='granted') Notification.requestPermission();
renderCurrentPanel();

// Schedule twice daily at 9am and 6pm
setInterval(()=>{
  const now=new Date();
  if(now.getHours()===9 || now.getHours()===18) scheduleExpiryNotifications();
},60*60*1000); // checks hourly
</script>

</body>
</html>



